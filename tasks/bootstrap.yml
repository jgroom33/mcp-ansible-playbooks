---
- name: capture MCP IP
  when: mcp is not defined
  block:
    - pause:
        prompt: "What is the IP address of MCP?"
        echo: true
      register: input
      run_once: true
    - name: set MCP IP
      set_fact:
        mcp: "{{ input.user_input }}"
        mcp_set: anything
- name: Store MCP IP
  when: mcp_set is defined
  block:
    - name: Open vars file
      slurp:
        path: vars.yml
      register: r_myfile
    - name: Read yaml to dictionary
      set_fact:
        mydata: "{{ r_myfile['content'] | b64decode | from_yaml }}"
    - name: Patch yaml dictionary
      set_fact:
        mydata: "{{ mydata | combine(newdata, recursive=True) }}"
      vars: 
        newdata:
          mcp: "{{ mcp }}"
    - name: Write yaml file
      copy:
        content: '{{ mydata | to_nice_yaml }}'
        dest: vars.yml

- name: Get token
  import_tasks: get_token.yml
- name: Get products
  import_tasks: get_products.yml
# - name: Get Network Constructs
#   import_tasks: get_network_constructs.yml
